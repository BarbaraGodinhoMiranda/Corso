<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        function remove(nodo){
        var nodo = nodo;
        
    while (nodo.firstChild) {
        nodo.removeChild(nodo.firstChild);
    }
}   

class song {
    constructor(titolo, autore, annopubblicazione, genere, img){
        this.titolo = titolo;
        this.autore = autore;
        this.annopubblicazione = annopubblicazione;
        this.genere = genere;
        this.img = img;
    }
}

window.onload = gestoreLoad;
let listaD = new Array();

function gestoreLoad(){

    if (localStorage.length == 0) {
        
        let d1 = new song("Un briciolo di allegria", "Mina", "2023", "Pop", "unbriciolo.jpg");
        let d2 = new song("Ragazza magica", "Jovanotti", 2016, "Pop", "ragazzamagica.jpg");
        let d3 = new song("Lugar comum","Jovanotti, Sergio Mendes", 2008, "Pop", "lugarcomum.jpg");
        listaD.push(d1);
        listaD.push(d2);
        listaD.push(d3);
        salvaDati();

    }
        else {
            listaD = JSON.parse(localStorage.getItem('canzoni'));
        }

    let btn = document.getElementById("btn");
    let btn1 = document.getElementById("btn1");
    let btn2 = document.getElementById("btn2");
    btn.onclick = inserisci;
    btn1.onclick = visualizza;
    btn2.onclick = cambia;
    let nodo = document.getElementById("result");

    function popolaSelect(){
    let nodoSelect = document.getElementById("nome1");


    for (let i = 0; i < listaD.length; i++) {
        let nodoOption = document.createElement("option");
        nodoOption.textContent = listaD[i].titolo;
        nodoOption.value = listaD[i].titolo;
        nodoSelect.appendChild(nodoOption);
    }
}
    popolaSelect();

    function salvaDati(){
        localStorage.setItem('canzoni', JSON.stringify(listaD));
        alert("lista aggiornata");
    }


    function inserisci(){
        let titolo = document.getElementById("titolo").value;
        let autore = document.getElementById("autore").value;
        let annopubblicazione = document.getElementById("annopubblicazione").value;
        let genere = document.getElementById("genere").value;
        let img = document.getElementById("img").value;
        let d1 = new song(titolo, autore, annopubblicazione, genere, img);
        listaD.push(d1);
        alert("canzone inserita con successo!");
        var nodoS = document.getElementById("nome1");
        remove(nodoS);
        popolaSelect();
        salvaDati();

    }

    function visualizza(){
        remove(nodo);

        for (let i = 0; i < listaD.length; i++){
             
            let nodoCard = document.createElement("div");
            nodoCard.className = "card";
            nodoCard.style.width = "18rem";
            let nodoImg = document.createElement("img");
            nodoImg.src = listaD[i].img;
            nodoImg.className = "card-img-top";
            nodoCard.appendChild(nodoImg);
            let nodoCardBody = document.createElement("div");
            nodoCardBody.className = "card-body";
            nodoCard.appendChild(nodoCardBody);
            let nodoTitolo = document.createElement("h5");
            nodoTitolo.className = "card-title";
            nodoTitolo.textContent = listaD[i].titolo;
            nodoCardBody.appendChild(nodoTitolo);
            let nodoText = document.createElement("p");
            nodoText.className = "card-text";
            
            nodoText.textContent = "titolo: " + listaD[i].autore + " genere: " + listaD[i].genere;
            nodoCardBody.appendChild(nodoText);
            nodo.appendChild(nodoCard);
           
        }
    }

    function cambia(){
        let ok = false;
        let titolo = document.getElementById("nome1").value;
        let img = document.getElementById("img1").value;
        for (let i = 0; i < listaD.length; i++){
            if (listaD[i].titolo == titolo) {
                listaD[i].img = img;
                ok = true;
            }
        }

        if (ok){
            alert("Titolo non trovato");
        }
        else {
            alert("Immagine modificata con successo");
        }

    }
}


    </script>
</head>
<body>
 <h1>Lista Canzoni</h1> 
 Inserisci il titolo: <input type = "text" id = "titolo">  <br><br>
 Inserisci l'autore: <input type = "text" id = "autore">  <br><br>
 Inserisci l'anno di pubblicazione: <input type = "text" id = "annopubblicazione">  <br><br>
 Inserisci il genere: <input type = "text" id = "genere">  <br><br>
 Inserisci l'immagine: <input type = "text" id = "img">  <br><br>
 <button id = "btn">Inserisci</button>
 <hr><hr>
 <button id = "btn1">Visualizza</button>
 <div id = "result"></div>
 <br><br>
 <hr>
 Inserisci nome della canzone da modificare l'immagine <select id = "nome1"> </select><br><br>
 Inserisci la nuova immagine <input type = "text" id = "img1"><br><br>
 <button id = "btn2">Cambia</button>
</body>
</html>